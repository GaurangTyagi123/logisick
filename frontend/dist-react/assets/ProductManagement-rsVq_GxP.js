const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CreateOrderModal-CPOSNneE.js","assets/index-DGdq0UJg.js","assets/index-4ul3zOFW.css","assets/Close-B_kHsTBg.js","assets/Modal-DKjyBxId.js","assets/button-BJYD--B9.js","assets/card-DED02hlv.js","assets/input-BQR0Vhqq.js","assets/label-DsFwhH02.js","assets/separator-DZ5S64f-.js","assets/apiOrg-Cb9F5o2f.js","assets/AddItemModal-CpKsGQSQ.js","assets/apiItem-sv9YjtW1.js","assets/CustomTableSkeleton-BiPxJ0xx.js","assets/skeleton-CuA9NrK2.js","assets/Pagination-Bim9olB9.js","assets/utilfn-VpFqLrdN.js"])))=>i.map(i=>d[i]);
import{a as _,b as h,y as O,c as D,r as n,j as e,L as T,_ as R}from"./index-DGdq0UJg.js";import{g as I,s as K,a as z}from"./apiItem-sv9YjtW1.js";import{g as A}from"./apiOrg-Cb9F5o2f.js";import{u as E,M as j,B as N,a as B,L as k}from"./button-BJYD--B9.js";import{l as $,C as M,a as U}from"./CustomTableSkeleton-BiPxJ0xx.js";import{E as V}from"./Profilepage-Qxb2z0jF.js";import{p as W}from"./utilfn-VpFqLrdN.js";import{c as Z,R as c}from"./ReportBar-D6tAQYMT.js";import{S as u}from"./skeleton-CuA9NrK2.js";import"./card-DED02hlv.js";import"./input-BQR0Vhqq.js";import"./separator-DZ5S64f-.js";import"./Pagination-Bim9olB9.js";import"./badge-D5jlqsIW.js";const H=5;function J(s,t){const i=_(),{data:a,isPending:o}=h({queryKey:["items",t],queryFn:()=>I(s,t)});return a&&H*t+1<a.count&&i.prefetchQuery({queryKey:["items",t+1],queryFn:()=>I(s,t+1)}),{itemsResponse:a,isGettingItems:o}}function X(){const s=_(),{mutate:t,isPending:i}=E({mutationFn:Z,onSuccess:()=>{s.invalidateQueries({predicate:a=>["orders","orders-report"].includes(a.queryKey[0]?.toString()||"")}),O.success("Order created successfully",{className:"toast"})},onError:a=>{O.error(a.message||"Error creating Order",{className:"toast"})}});return{createOrderFn:t,isCreatingOrder:i}}const Y=n.lazy(()=>R(()=>import("./CreateOrderModal-CPOSNneE.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])));function ee(){const{orgSlug:s}=D(),t=5,[i,a]=n.useState(1),[o,l]=n.useState(1),[f,q]=n.useState({itemName:"",itemId:"",itemAmount:0}),[F,b]=n.useState(!1),{createOrderFn:L,isCreatingOrder:w}=X(),{data:x,isPending:G}=h({queryKey:[`org-${s}`],queryFn:()=>A(s)}),{itemsResponse:m,isGettingItems:p}=J(x._id,i),[S,v]=n.useState(null),{mutate:P}=E({mutationFn:K,onSettled:r=>{if(r)v(r.items);else return}}),g=n.useRef(null),C=n.useCallback(async r=>{g.current&&g.current.abort();const d=new AbortController;if(g.current=d,r.trim().length)return P({orgid:x._id,query:r,controller:d})},[x._id,P]),y=n.useMemo(()=>$.debounce(C,500),[C]),Q=n.useCallback(r=>{if(r.trim()===""){y.cancel(),v(null),g.current&&g.current.abort();return}y(r)},[y]);return n.useEffect(()=>{!p&&m&&l(m.count>t?Math.ceil(m.count/t):1)},[m,p,o]),p||G?e.jsx(M,{}):e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Items",columns:[{key:"name",header:"Name",render:r=>e.jsx("span",{className:"font-bold",children:r instanceof Date?new Date(r).toLocaleDateString():r})},{key:"importedOn",header:"Imported On",render:r=>r?new Date(r).toLocaleDateString():e.jsx(j,{children:"NA"})},{key:"expiresOn",header:"Expires On",render:r=>r?new Date(r).toLocaleDateString():e.jsx(j,{children:"NA"})},{key:"inventoryCategory",header:"Category"},{key:"batchNumber",header:"Batch No.",render:r=>r?r instanceof Date?new Date(r).toLocaleDateString():r:e.jsx(j,{children:"NA"})},{key:"weight",header:"Unit Weight",render:r=>W(Number(r))},{key:"quantity",header:"Quantity"},{key:"costPrice",header:"Cost Price",render:r=>e.jsxs("span",{className:"w-full font-bold text-red-400",children:[r instanceof Date?new Date(r).toLocaleDateString():r," ","/-"]})},{key:"sellingPrice",header:"Selling Price",render:r=>e.jsxs("span",{className:"w-full font-bold text-green-400",children:[r instanceof Date?new Date(r).toLocaleDateString():r," ","/-"]})},{key:"createorder",header:"Create Order",render:(r,d)=>e.jsx(N,{disabled:w,onClick:()=>{q({itemId:d._id,itemName:d.name,itemAmount:d.quantity}),b(!0)},variant:"outline",size:"sm",className:"text-xs sm:text-sm",children:"Create Order"})},{key:"Manage",header:"Manage",render:(r,d)=>e.jsx(T,{to:`/item/${x.slug}/${d.SKU}`,children:e.jsx(N,{variant:"outline",size:"sm",children:e.jsx(V,{})})})}],clientSide:!0,data:S||m?.items||[],currentPage:i,totalPages:o,setPage:a,onSearch:Q}),e.jsx(Y,{open:F,setOpen:b,orderdata:f,createOrderFn:L,isCreatingOrder:w})]})}function re(s){const{data:t,isPending:i,isError:a,error:o}=h({queryKey:["items-report",s],queryFn:()=>z(s),enabled:!!s});return{report:t,isGettingItemReport:i,isError:a,error:o}}const te=n.lazy(()=>R(()=>import("./AddItemModal-CpKsGQSQ.js"),__vite__mapDeps([11,1,2,3,4,5,6,9,7,8,12,10,13,14,15,16])));function pe(){const[s,t]=n.useState(!1),{orgSlug:i}=D(),{data:a,isPending:o}=h({queryKey:[`org-${i}`],queryFn:()=>A(i)}),{report:l,isGettingItemReport:f}=re(a?._id);return o||f?e.jsxs("div",{className:"flex flex-col gap-2  items-baseline h-full w-autorounded-2xl bg-ls-bg-300 dark:bg-ls-bg-dark-800",children:[e.jsxs("div",{className:"bg-white dark:bg-ls-bg-dark-800 outline-1 w-full p-3 rounded-2xl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center w-full",children:[e.jsx(u,{className:"w-1/3 h-10"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{className:"h-18 w-18"}),e.jsx(u,{className:"h-18 w-18"})]})]}),e.jsx(u,{className:"w-1/2 h-5"})]}),e.jsx("div",{className:"outline-1 p-4  w-full rounded-2xl",children:e.jsx(u,{className:"w-full h-30"})}),e.jsx(M,{})]}):e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsxs("div",{className:"grid w-full md:flex md:items-center md:justify-between gap-2 p-1 md:p-3 rounded-lg md:rounded-2xl bg-white dark:bg-ls-bg-dark-800 outline-1",children:[e.jsx(B,{children:"Product Management"}),e.jsx(N,{onClick:()=>t(!0),children:"Add New Item"})]}),e.jsxs("main",{className:"w-full grid gap-2 rounded-lg md:rounded-2xl h-full",children:[e.jsxs("div",{className:"outline-1 p-3 rounded-lg md:rounded-2xl flex flex-col gap-2 w-full bg-white dark:bg-ls-bg-dark-800",children:[e.jsx(k,{children:"Items Summary"}),l?e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 w-full gap-2",children:[e.jsx(c,{name:"No. of Items",value:l.numOfItems,variant:"outline"}),e.jsx(c,{name:"Total Quantity",value:l.totalQuantity,variant:"outline"}),e.jsx(c,{name:"Avg. Quantity per Item",value:l.averageQuantity,variant:"outline"})]}),e.jsxs("div",{className:"grid gap-2 w-full grid-cols-1 2xl:grid-cols-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 w-full gap-2",children:[e.jsx(c,{name:"Total Cost Price",value:l.totalCostPrice,suffix:"INR",currency:!0,variant:"secondary"}),e.jsx(c,{name:"Total Selling Price",value:l.totalSellingPrice,suffix:"INR",currency:!0,variant:"secondary"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 w-full gap-2",children:[e.jsx(c,{name:"Avg. Cost Price",value:l.averageCostPrice,suffix:"INR",currency:!0,variant:"secondary"}),e.jsx(c,{name:"Avg. Selling Price",value:l.averageSellingPrice,suffix:"INR",currency:!0,variant:"secondary"})]})]})]}):f?e.jsx("div",{className:"w-full",children:e.jsx(u,{className:"w-full h-30"})}):e.jsx(k,{className:"w-full",children:"No Report Found"})]}),e.jsx(ee,{})]}),e.jsx(te,{open:s,setOpen:t})]})}export{pe as default};
