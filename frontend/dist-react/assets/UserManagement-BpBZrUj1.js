const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChangeEmpManagerModal-CuXvkv-J.js","assets/index-H5JN5wYo.js","assets/index-bkEeQSt0.css","assets/Modal-DKz5Ep2_.js","assets/button-BKGA3V9u.js","assets/Typography-B3Ue9uXG.js","assets/card-gZVURdSA.js","assets/Close-DYe8Ue7o.js","assets/label-38rcBngi.js","assets/separator-BvH7fElG.js","assets/input-3C9xSQ2x.js","assets/ChangeEmpRoleModal-CP0kPtVY.js","assets/DeleteEmpModal-BxGmSYS-.js","assets/InviteEmpModal-ZLJXic8M.js","assets/apiEmp-B18LuAhT.js","assets/index-CrBqofG1.js"])))=>i.map(i=>d[i]);
import{c as j,y as m,r as t,j as e,_ as h,b as z,a as W,d as Y,e as J}from"./index-H5JN5wYo.js";import{u as X}from"./useGetEmployees-CF_zMK11.js";import{u as f,B as g}from"./button-BKGA3V9u.js";import{s as w,g as ee}from"./apiOrg-CGbk-Uv3.js";import{U as I}from"./UserAvatar-dKZU2kgn.js";import{l as ae,C as F,a as se}from"./CustomTableSkeleton-CCaRVfEI.js";import{d as te,c as ne,a as re}from"./apiEmp-B18LuAhT.js";import{D as le}from"./Profilepage-CAiVENpA.js";import{a as A}from"./Typography-B3Ue9uXG.js";import"./card-gZVURdSA.js";import"./input-3C9xSQ2x.js";import"./separator-BvH7fElG.js";import"./table-DUrCdX0m.js";import"./Pagination-ftEwcjGl.js";import"./skeleton-CycT_Ail.js";function oe(){const n=j(),{mutate:r,isPending:o}=f({mutationFn:({userid:s,orgid:l})=>te(s,l),onSuccess:s=>{n.invalidateQueries({predicate:l=>l.queryKey[0]?.toString()==="emps"}),m.success("Employee deleted successfully",{className:"toast"})},onError:s=>m.error(s.message,{className:"toast"})});return{deleteEmp:r,isDeletingEmployee:o}}function ie(){const n=j(),{mutate:r,isPending:o}=f({mutationFn:({orgid:s,newRole:l,userid:c})=>ne(s,l,c),onSuccess:()=>{n.invalidateQueries({predicate:s=>s.queryKey[0]?.toString()==="emps"}),m.success("Role changed successfully",{className:"toast"})},onError:s=>m.error(s.message,{className:"toast"})});return{changeEmpRole:r,isChangingRole:o}}function ce(){const n=j(),{mutate:r,isPending:o}=f({mutationFn:({userid:s,managerEmail:l,orgid:c})=>re(s,l,c),onSuccess:s=>{n.invalidateQueries({predicate:l=>l.queryKey[0]?.toString()==="emps"}),m.success("Manager Changed successfully",{className:"toast"})},onError:s=>m.error(s.message,{className:"toast"})});return{changeEmpManager:r,isChangingManager:o}}const me=t.lazy(()=>h(()=>import("./ChangeEmpManagerModal-CuXvkv-J.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),ue=t.lazy(()=>h(()=>import("./ChangeEmpRoleModal-CP0kPtVY.js"),__vite__mapDeps([11,1,2,3,4,5,6,7,9]))),de=t.lazy(()=>h(()=>import("./DeleteEmpModal-BxGmSYS-.js"),__vite__mapDeps([12,1,2,7,3,4,5,6,8,9,10])));function q(n){return n?.map(r=>({role:r?.data?.role,...r?.data?.employees}))||[]}function pe({orgid:n,isAuthorized:r}){const[s,l]=t.useState(1),[c,d]=t.useState(1),[T,v]=t.useState(!1),[G,M]=t.useState(!1),[K,S]=t.useState(!1),[E,y]=t.useState({_id:"",name:"",email:""}),[Q,L]=t.useState(),{data:U,count:x,isGettingEmployees:_,error:R}=X(n,c),{deleteEmp:V,isDeletingEmployee:C}=oe(),{changeEmpRole:Z,isChangingRole:N}=ie(),{changeEmpManager:$,isChangingManager:O}=ce(),[b,P]=t.useState(null),{mutate:k}=f({mutationFn:w,onSettled:i=>{if(i)P(q(i.employees.map(a=>({data:a}))));else return}}),u=t.useRef(null),D=t.useCallback(async i=>{u.current&&u.current.abort();const a=new AbortController;u.current=a,i.trim().length&&k({orgid:n,query:i,controller:a})},[n,k]),p=t.useMemo(()=>ae.debounce(D,500),[D]),B=t.useCallback(i=>{if(i.trim()===""){p.cancel(),P(null),u.current&&u.current.abort();return}p(i)},[p]);if(t.useEffect(()=>{_||l(x>5?Math.ceil(x/5):1)},[x,_]),t.useEffect(()=>()=>{p.cancel(),u.current?.abort()},[p]),_)return e.jsx(F,{});if(R){m.error(R.message,{className:"toast"});return}const H=q(U);return e.jsxs(e.Fragment,{children:[e.jsx(se,{title:"Employees",columns:r()?[{key:"name",header:"Name",render:(i,a)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(I,{className:"w-10 h-10 hidden sm:grid",customSeed:a.avatar}),e.jsxs("span",{className:"flex",children:[a?.name," - ( ",a?.role," ",")"]})]})},{key:"email",header:"Email"},{key:"Manage Employee",header:"Manage Employee",render:(i,a)=>e.jsx("div",{className:"flex gap-2 justify-end items-center",children:a.role!=="Owner"&&e.jsxs(e.Fragment,{children:[e.jsx(g,{disabled:N,onClick:()=>{y({_id:a._id,name:a.name,email:a.email}),L(a.role),M(!0)},variant:"outline",size:"sm",className:"text-xs sm:text-sm",children:"Role"}),e.jsx(g,{disabled:O,onClick:()=>{y({_id:a._id,name:a.name,email:a.email}),S(!0)},variant:"outline",title:`Remove ${a.name} from organization`,size:"sm",className:"text-xs sm:text-sm",children:"Manager"}),e.jsx(g,{disabled:C,onClick:()=>{y({_id:a._id,name:a.name,email:a.email}),v(!0)},variant:"destructive",title:`Remove ${a.name} from organization`,size:"sm",children:e.jsx(le,{})})]})})}]:[{key:"name",header:"Name",render:(i,a)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(I,{className:"w-10 h-10",customSeed:a.avatar}),e.jsxs("span",{className:"hidden sm:flex",children:[a?.name," - ( ",a?.role," ",")"]})]})},{key:"email",header:"Email"}],clientSide:!0,data:b||H,currentPage:c,totalPages:s,setPage:d,onSearch:B}),e.jsx(de,{open:T,setOpen:v,orgid:n,empData:E,deleteEmp:V,isPending:C}),e.jsx(ue,{open:G,setOpen:M,changeRole:Z,empData:E,isPending:N,oldRole:Q||"Staff",orgid:n}),e.jsx(me,{changeManager:$,empData:E,isPending:O,open:K,orgid:n,setOpen:S})]})}const ge=t.lazy(()=>h(()=>import("./InviteEmpModal-ZLJXic8M.js"),__vite__mapDeps([13,1,2,6,5,3,4,7,9,10,14,15])));function Pe(){const[n,r]=t.useState(!1),{data:o}=z({queryKey:["user"],queryFn:()=>J()}),{orgSlug:s}=W(),{data:l,isPending:c}=z({queryKey:[`org-${s}`],queryFn:()=>ee(s)}),d=()=>o?.user.myOrg?!!(o?.user||o?.user._id===o?.user.myOrg?.admin):!1;return e.jsxs("div",{className:"gap-2 grid",children:[e.jsxs("div",{className:"bg-white dark:bg-ls-bg-dark-800 outline-1 w-full p-1 md:p-3 rounded-lg md:rounded-2xl grid md:flex md:justify-between items-center",children:[e.jsx(A,{children:"User & Role"}),e.jsx("div",{className:Y(d()?"grid":"hidden"),children:e.jsx(g,{onClick:()=>r(!0),disabled:!d(),children:"Invite Employee"})})]}),c?e.jsx(F,{}):l?e.jsx(pe,{orgid:l?._id,isAuthorized:d}):e.jsxs("div",{className:"h-96 w-full flex flex-col justify-center items-center gap-3 outline-1",children:[e.jsx(A,{children:"Your Organization doesn't have any employees"}),e.jsx(g,{onClick:()=>r(!0),children:"Invite Employees"})]}),e.jsx(ge,{open:n,setOpen:r})]})}export{Pe as default};
