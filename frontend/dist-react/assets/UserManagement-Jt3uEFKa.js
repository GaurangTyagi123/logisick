import{u as z,y,r as i,j as e,a as X,b as be,c as Se,d as Me}from"./index-OmV3yq9G.js";import{u as ke}from"./useGetEmployees-CNLYbsEH.js";import{u as S,B as m,S as Pe,a as L,c as se,b as J}from"./button-9vMW9_oR.js";import{s as Ie,g as _e}from"./apiOrg-D2Y_Y1tc.js";import{U as ee}from"./UserAvatar-D16AkYtt.js";import{l as we,C as ne,a as Ae}from"./CustomTableSkeleton-D7meaU38.js";import{d as Ge,c as De,a as Fe,s as Oe}from"./apiEmp-xDAAENVP.js";import{C as M}from"./Close-C8HdlCrP.js";import{M as k}from"./Modal-DM6aciIk.js";import{C as P,a as I,b as _,c as w,d as A}from"./card-DDFRYrzS.js";import{L as re}from"./label-DMqxW8Nh.js";import{I as K}from"./input-DYqCBqzr.js";import{D as qe}from"./Profilepage-ngNGz7hp.js";import{D as Te,a as ze,b as Le,c as Ke,d as te,u as Ue,e as Be,f as oe,R as Ve,P as G,I as $e,g as T,h as Qe,i as He,C as Ze,L as b}from"./separator-DYVVEmrN.js";import{u as We}from"./index-BMjTRGb1.js";import"./skeleton-cGjqwgCH.js";import"./Pagination-H71kDw6O.js";function Ye(){const r=z(),{mutate:s,isPending:a}=S({mutationFn:({userid:n,orgid:t})=>Ge(n,t),onSuccess:n=>{r.invalidateQueries({predicate:t=>t.queryKey[0]?.toString()==="emps"}),y.success("Employee deleted successfully",{className:"toast"})},onError:n=>y.error(n.message,{className:"toast"})});return{deleteEmp:s,isPending:a}}function Xe({open:r,setOpen:s,empData:a,orgid:n,deleteEmp:t,isPending:o}){const[l,d]=i.useState("");return e.jsx(k,{openModal:r,children:e.jsxs(P,{className:"max-w-screen",children:[e.jsxs(I,{className:"flex justify-between items-center",children:[e.jsxs(_,{children:["Remove Employee ",a.name]}),e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:e.jsx(M,{})})]}),e.jsxs(w,{className:"grid gap-2",children:[e.jsxs(Pe,{children:["Employee Email : ",a.email]}),e.jsxs(re,{title:"remove employee",htmlFor:"removeemp",className:"grid",children:[e.jsxs("span",{children:['Enter "',e.jsxs("span",{className:"text-red-500",children:["remove ",a.name]}),'" in the input below to remove employee']}),e.jsx(K,{placeholder:"Enter Text",type:"text",value:l,name:"name",required:!0,className:"text-sm md:text-md",onChange:u=>d(u.target.value)})]})]}),e.jsxs(A,{className:"flex gap-2",children:[e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:"Cancel"}),e.jsx(m,{type:"button",onClick:()=>{t({userid:a._id,orgid:n}),d(""),s(!1)},disabled:o||l.trim()!==`remove ${a.name}`,variant:"destructive",children:"Remove Employee"})]})]})})}function Je(){const r=z(),{mutate:s,isPending:a}=S({mutationFn:({orgid:n,newRole:t,userid:o})=>De(n,t,o),onSuccess:()=>{r.invalidateQueries({predicate:n=>n.queryKey[0]?.toString()==="emps"}),y.success("Role changed successfully",{className:"toast"})},onError:n=>y.error(n.message,{className:"toast"})});return{changeEmpRole:s,isPending:a}}function ea({open:r,setOpen:s,empData:a,orgid:n,oldRole:t,changeRole:o,isPending:l}){const[d,u]=i.useState(t),h=()=>{d?o({orgid:n,newRole:d,userid:a._id}):y.error("Select role first",{className:"toast"})};return e.jsx(k,{openModal:r,children:e.jsxs(P,{className:"max-w-screen",children:[e.jsxs(I,{className:"flex justify-between items-center",children:[e.jsxs(_,{children:["Change Role of ",a.name]}),e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:e.jsx(M,{})})]}),e.jsx(w,{className:"grid gap-2",children:e.jsxs(Te,{children:[e.jsx(ze,{asChild:!0,children:e.jsxs(m,{variant:"outline",children:[d," v"]})}),e.jsx(Le,{children:["Admin","Manager","Staff"].filter(p=>p!=t).map((p,g)=>e.jsx(Ke,{asChild:!0,children:e.jsx(m,{variant:"outline",className:"w-full",onClick:()=>u(p),children:p})},`${g}-role`))})]})}),e.jsxs(A,{className:"flex gap-2",children:[e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:"Cancel"}),e.jsx(m,{type:"button",onClick:()=>{h(),s(!1)},disabled:l,children:"Change Role"})]})]})})}function aa(){const r=z(),{mutate:s,isPending:a}=S({mutationFn:({userid:n,managerEmail:t,orgid:o})=>Fe(n,t,o),onSuccess:n=>{r.invalidateQueries({predicate:t=>t.queryKey[0]?.toString()==="emps"}),y.success("Manager Changed successfully",{className:"toast"})},onError:n=>y.error(n.message,{className:"toast"})});return{changeEmpManager:s,isPending:a}}function sa({open:r,setOpen:s,empData:a,orgid:n,changeManager:t,isPending:o}){const[l,d]=i.useState(""),u=()=>{t({orgid:n,managerEmail:l,userid:a._id})};return e.jsx(k,{openModal:r,children:e.jsxs(P,{className:"",children:[e.jsxs(I,{className:"flex justify-between items-center",children:[e.jsxs(_,{children:["Change Role of ",a.name]}),e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:e.jsx(M,{})})]}),e.jsx(w,{className:"grid gap-2",children:e.jsxs(re,{title:"change emp Manager",htmlFor:"changemanager",className:"grid",children:[e.jsx("span",{children:"Manager's email id"}),e.jsx(K,{placeholder:"Enter manager's email id",type:"email",value:l,name:"managerEmail",required:!0,className:"text-sm md:text-md",onChange:h=>d(h.target.value)})]})}),e.jsxs(A,{className:"flex gap-2",children:[e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:"Cancel"}),e.jsx(m,{type:"button",onClick:()=>{u(),s(!1)},disabled:o,children:"Change Manager"})]})]})})}function ae(r){return r?.map(s=>({role:s?.data?.role,...s?.data?.employees}))||[]}function na({orgid:r,isAuthorized:s}){const[n,t]=i.useState(1),[o,l]=i.useState(1),[d,u]=i.useState(!1),[h,p]=i.useState(!1),[g,v]=i.useState(!1),[f,x]=i.useState({_id:"",name:"",email:""}),[E,R]=i.useState(),{data:je,count:F,isPending:O,error:B}=ke(r,o),{deleteEmp:ye,isPending:V}=Ye(),{changeEmpRole:Ee,isPending:$}=Je(),{changeEmpManager:Re,isPending:Q}=aa(),[H,Z]=i.useState(null),{mutate:W}=S({mutationFn:Ie,onSettled:j=>{if(j)Z(ae(j.employees.map(c=>({data:c}))));else return}}),C=i.useRef(null),Y=i.useCallback(async j=>{C.current&&C.current.abort();const c=new AbortController;C.current=c,j.trim().length&&W({orgid:r,query:j,controller:c})},[r,W]),N=i.useMemo(()=>we.debounce(Y,500),[Y]),Ce=i.useCallback(j=>{if(j.trim()===""){N.cancel(),Z(null),C.current&&C.current.abort();return}N(j)},[N]);if(i.useEffect(()=>{O||t(F>5?Math.ceil(F/5):1)},[F,O]),i.useEffect(()=>()=>{N.cancel(),C.current?.abort()},[N]),O)return e.jsx(ne,{});if(B){y.error(B.message,{className:"toast"});return}const Ne=ae(je);return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:"Employees",columns:s()?[{key:"name",header:"Name",render:(j,c)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(ee,{className:"w-10 h-10 hidden sm:grid",customSeed:c.avatar}),e.jsxs("span",{className:"flex",children:[c?.name," - ( ",c?.role," ",")"]})]})},{key:"email",header:"Email"},{key:"Manage Employee",header:"Manage Employee",render:(j,c)=>e.jsx("div",{className:"flex gap-2 justify-end items-center",children:c.role!=="Owner"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{disabled:$,onClick:()=>{x({_id:c._id,name:c.name,email:c.email}),R(c.role),p(!0)},variant:"outline",size:"sm",className:"text-xs ms:text-sm",children:"Role"}),e.jsx(m,{disabled:Q,onClick:()=>{x({_id:c._id,name:c.name,email:c.email}),v(!0)},variant:"outline",title:`Remove ${c.name} from organization`,size:"sm",className:"text-xs ms:text-sm",children:"Manager"}),e.jsx(m,{disabled:V,onClick:()=>{x({_id:c._id,name:c.name,email:c.email}),u(!0)},variant:"destructive",title:`Remove ${c.name} from organization`,size:"sm",children:e.jsx(qe,{})})]})})}]:[{key:"name",header:"Name",render:(j,c)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(ee,{className:"w-10 h-10",customSeed:c.avatar}),e.jsxs("span",{className:"hidden sm:flex",children:[c?.name," - ( ",c?.role," ",")"]})]})},{key:"email",header:"Email"}],clientSide:!0,data:H||Ne,currentPage:o,totalPages:n,setPage:l,onSearch:Ce}),e.jsx(Xe,{open:d,setOpen:u,orgid:r,empData:f,deleteEmp:ye,isPending:V}),e.jsx(ea,{open:h,setOpen:p,changeRole:Ee,empData:f,isPending:$,oldRole:E||"Staff",orgid:r}),e.jsx(sa,{changeManager:Re,empData:f,isPending:Q,open:g,orgid:r,setOpen:v})]})}function ra(){const{mutate:r,isPending:s}=S({mutationFn:({empEmail:a,role:n})=>Oe(a,n),onSuccess:a=>{y.success(a?.message,{className:"toast"})},onError:a=>y.error(a.message,{className:"toast"})});return{sendInvitation:r,isPending:s}}var U="Radio",[ta,ie]=oe(U),[oa,ia]=ta(U),le=i.forwardRef((r,s)=>{const{__scopeRadio:a,name:n,checked:t=!1,required:o,disabled:l,value:d="on",onCheck:u,form:h,...p}=r,[g,v]=i.useState(null),f=L(s,R=>v(R)),x=i.useRef(!1),E=g?h||!!g.closest("form"):!0;return e.jsxs(oa,{scope:a,checked:t,disabled:l,children:[e.jsx(G.button,{type:"button",role:"radio","aria-checked":t,"data-state":me(t),"data-disabled":l?"":void 0,disabled:l,value:d,...p,ref:f,onClick:T(r.onClick,R=>{t||u?.(),E&&(x.current=R.isPropagationStopped(),x.current||R.stopPropagation())})}),E&&e.jsx(ue,{control:g,bubbles:!x.current,name:n,value:d,checked:t,required:o,disabled:l,form:h,style:{transform:"translateX(-100%)"}})]})});le.displayName=U;var ce="RadioIndicator",de=i.forwardRef((r,s)=>{const{__scopeRadio:a,forceMount:n,...t}=r,o=ia(ce,a);return e.jsx(Qe,{present:n||o.checked,children:e.jsx(G.span,{"data-state":me(o.checked),"data-disabled":o.disabled?"":void 0,...t,ref:s})})});de.displayName=ce;var la="RadioBubbleInput",ue=i.forwardRef(({__scopeRadio:r,control:s,checked:a,bubbles:n=!0,...t},o)=>{const l=i.useRef(null),d=L(l,o),u=We(a),h=He(s);return i.useEffect(()=>{const p=l.current;if(!p)return;const g=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(g,"checked").set;if(u!==a&&f){const x=new Event("click",{bubbles:n});f.call(p,a),p.dispatchEvent(x)}},[u,a,n]),e.jsx(G.input,{type:"radio","aria-hidden":!0,defaultChecked:a,...t,tabIndex:-1,ref:d,style:{...t.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ue.displayName=la;function me(r){return r?"checked":"unchecked"}var ca=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],D="RadioGroup",[da,Fa]=oe(D,[te,ie]),pe=te(),fe=ie(),[ua,ma]=da(D),he=i.forwardRef((r,s)=>{const{__scopeRadioGroup:a,name:n,defaultValue:t,value:o,required:l=!1,disabled:d=!1,orientation:u,dir:h,loop:p=!0,onValueChange:g,...v}=r,f=pe(a),x=Ue(h),[E,R]=Be({prop:o,defaultProp:t??null,onChange:g,caller:D});return e.jsx(ua,{scope:a,name:n,required:l,disabled:d,value:E,onValueChange:R,children:e.jsx(Ve,{asChild:!0,...f,orientation:u,dir:x,loop:p,children:e.jsx(G.div,{role:"radiogroup","aria-required":l,"aria-orientation":u,"data-disabled":d?"":void 0,dir:x,...v,ref:s})})})});he.displayName=D;var xe="RadioGroupItem",ge=i.forwardRef((r,s)=>{const{__scopeRadioGroup:a,disabled:n,...t}=r,o=ma(xe,a),l=o.disabled||n,d=pe(a),u=fe(a),h=i.useRef(null),p=L(s,h),g=o.value===t.value,v=i.useRef(!1);return i.useEffect(()=>{const f=E=>{ca.includes(E.key)&&(v.current=!0)},x=()=>v.current=!1;return document.addEventListener("keydown",f),document.addEventListener("keyup",x),()=>{document.removeEventListener("keydown",f),document.removeEventListener("keyup",x)}},[]),e.jsx($e,{asChild:!0,...d,focusable:!l,active:g,children:e.jsx(le,{disabled:l,required:o.required,checked:g,...u,...t,name:o.name,ref:p,onCheck:()=>o.onValueChange(t.value),onKeyDown:T(f=>{f.key==="Enter"&&f.preventDefault()}),onFocus:T(t.onFocus,()=>{v.current&&h.current?.click()})})})});ge.displayName=xe;var pa="RadioGroupIndicator",ve=i.forwardRef((r,s)=>{const{__scopeRadioGroup:a,...n}=r,t=fe(a);return e.jsx(de,{...t,...n,ref:s})});ve.displayName=pa;var fa=he,ha=ge,xa=ve;function ga({className:r,...s}){return e.jsx(fa,{"data-slot":"radio-group",className:se("grid gap-3",r),...s})}function q({className:r,...s}){return e.jsx(ha,{"data-slot":"radio-group-item",className:se("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",r),...s,children:e.jsx(xa,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(Ze,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}function va({open:r,setOpen:s}){const[a,n]=i.useState({empEmail:"",role:"Staff"}),{sendInvitation:t,isPending:o}=ra();function l(){a.empEmail.trim()!==""&&["Admin","Manager","Staff"].includes(a.role.trim())?(t(a),s(!1),n({empEmail:"",role:"Staff"})):y.error("Enter the text first",{className:"toast"})}return e.jsx(k,{openModal:r,children:e.jsxs(P,{className:"max-w-screen",children:[e.jsxs(I,{className:"flex justify-between items-center",children:[e.jsx(_,{children:"Send Invite"}),e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:e.jsx(M,{})})]}),e.jsxs(w,{className:"grid gap-3",children:[e.jsxs(b,{title:"New Employee's Email",className:"grid",children:[e.jsx("span",{children:"Employee's email"}),e.jsx(K,{placeholder:"Enter new employee's email",type:"email",value:a.empEmail,name:"empEmail",required:!0,className:"text-sm md:text-md",onChange:d=>n({...a,empEmail:d.target.value.trim()})})]}),e.jsxs(b,{title:"New Employee's role",className:"grid",children:[e.jsx("span",{children:"Enter new employee's role"}),e.jsxs(ga,{defaultValue:a.role,className:"flex",onValueChange:d=>n({...a,role:d}),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{value:"Staff",id:"r1",className:"text-ls-sec-500"}),e.jsx(b,{children:"Staff"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{value:"Manager",id:"r2",className:"text-ls-sec-500"}),e.jsx(b,{children:"Manager"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{value:"Admin",id:"r3",className:"text-ls-sec-500"}),e.jsx(b,{children:"Admin"})]})]})]})]}),e.jsx(A,{className:"flex gap-2",children:e.jsx(m,{type:"button",onClick:l,className:"w-full",disabled:o||a.empEmail.trim()==""||!["Admin","Manager","Staff"].includes(a.role.trim()),children:"Send Invite"})})]})})}function Oa(){const[r,s]=i.useState(!1),{data:a}=X({queryKey:["user"],queryFn:()=>Me()}),{orgSlug:n}=be(),{data:t,isPending:o}=X({queryKey:[`org-${n}`],queryFn:()=>_e(n)}),l=()=>a?.user.myOrg?!!(a?.user||a?.user._id===a?.user.myOrg?.admin):!1;return e.jsxs("div",{className:"gap-2 grid",children:[e.jsxs("div",{className:"bg-white dark:bg-ls-bg-dark-800 outline-1 w-full p-1 md:p-3 rounded-lg md:rounded-2xl grid md:flex md:justify-between items-center",children:[e.jsx(J,{children:"User & Role"}),e.jsx("div",{className:Se(l()?"grid":"hidden"),children:e.jsx(m,{onClick:()=>s(!0),disabled:!l(),children:"Invite Employee"})})]}),o?e.jsx(ne,{}):t?e.jsx(na,{orgid:t?._id,isAuthorized:l}):e.jsxs("div",{className:"h-96 w-full flex flex-col justify-center items-center gap-3 outline-1",children:[e.jsx(J,{children:"Your Organization doesn't have any employees"}),e.jsx(m,{onClick:()=>s(!0),children:"Invite Employees"})]}),e.jsx(va,{open:r,setOpen:s})]})}export{Oa as default};
