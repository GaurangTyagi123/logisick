import{u as L,y as j,r as i,j as e,a as W,b as Ne,c as be,d as Se}from"./index-ByPv5Bvs.js";import{u as Me}from"./useGetEmployees-CBGzdQ7W.js";import{u as N,B as m,S as ke,a as K,c as ae,b as X}from"./button-CGpUeQNU.js";import{s as Pe,g as Ie}from"./apiOrg-CGtHjoFi.js";import{U as J}from"./UserAvatar-WpywStcO.js";import{l as we,C as se,a as _e}from"./CustomTableSkeleton-CCcoYQM8.js";import{d as Ae,c as Ge,a as De,s as Fe}from"./apiEmp-BDISQNaO.js";import{C as S}from"./Close-CnCZ8KQD.js";import{M}from"./Modal-CsqSQ6m2.js";import{C as k,a as P,b as I,c as w,d as _}from"./card-hnSC__fQ.js";import{L as ne}from"./label-CNNC-uAT.js";import{I as z}from"./input-XNtBvshv.js";import{D as Oe}from"./Profilepage-DbTKIAbK.js";import{D as qe,a as Te,b as Le,c as Ke,d as re,u as ze,e as Ue,f as te,R as Be,P as A,I as Ve,g as T,h as $e,i as Qe,C as He,L as R}from"./dropdown-menu-DA2naSt3.js";import{u as Ze}from"./index-BRsO6Q9T.js";import"./table-Dx9VYOo0.js";import"./Pagination-6rRt_1HW.js";function Ye(){const r=L(),{mutate:s,isPending:a}=N({mutationFn:({userid:n,orgid:t})=>Ae(n,t),onSuccess:n=>{r.invalidateQueries({predicate:t=>t.queryKey[0]?.toString()==="emps"}),j.success("Employee deleted successfully",{className:"toast"})},onError:n=>j.error(n.message,{className:"toast"})});return{deleteEmp:s,isPending:a}}function We({open:r,setOpen:s,empData:a,orgid:n,deleteEmp:t,isPending:o}){const[l,d]=i.useState("");return e.jsx(M,{openModal:r,children:e.jsxs(k,{children:[e.jsxs(P,{className:"flex justify-between items-center",children:[e.jsxs(I,{children:["Remove Employee ",a.name]}),e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:e.jsx(S,{})})]}),e.jsxs(w,{className:"grid gap-2",children:[e.jsxs(ke,{children:["Employee Email : ",a.email]}),e.jsxs(ne,{title:"remove employee",htmlFor:"removeemp",className:"grid",children:[e.jsxs("span",{children:['Enter "',e.jsxs("span",{className:"text-red-500",children:["remove ",a.name]}),'" in the input below to remove employee']}),e.jsx(z,{placeholder:"Enter Text",type:"text",value:l,name:"name",required:!0,className:"text-sm md:text-md",onChange:u=>d(u.target.value)})]})]}),e.jsxs(_,{className:"flex gap-2",children:[e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:"Cancel"}),e.jsx(m,{type:"button",onClick:()=>{t({userid:a._id,orgid:n}),d(""),s(!1)},disabled:o||l.trim()!==`remove ${a.name}`,variant:"destructive",children:"Remove Employee"})]})]})})}function Xe(){const r=L(),{mutate:s,isPending:a}=N({mutationFn:({orgid:n,newRole:t,userid:o})=>Ge(n,t,o),onSuccess:()=>{r.invalidateQueries({predicate:n=>n.queryKey[0]?.toString()==="emps"}),j.success("Role changed successfully",{className:"toast"})},onError:n=>j.error(n.message,{className:"toast"})});return{changeEmpRole:s,isPending:a}}function Je({open:r,setOpen:s,empData:a,orgid:n,oldRole:t,changeRole:o,isPending:l}){const[d,u]=i.useState(t),h=()=>{d?o({orgid:n,newRole:d,userid:a._id}):j.error("Select role first",{className:"toast"})};return e.jsx(M,{openModal:r,children:e.jsxs(k,{className:"min-w-sm md:min-w-md",children:[e.jsxs(P,{className:"flex justify-between items-center",children:[e.jsxs(I,{children:["Change Role of ",a.name]}),e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:e.jsx(S,{})})]}),e.jsx(w,{className:"grid gap-2",children:e.jsxs(qe,{children:[e.jsx(Te,{asChild:!0,children:e.jsxs(m,{variant:"outline",children:[d," v"]})}),e.jsx(Le,{children:["Admin","Manager","Staff"].filter(p=>p!=t).map((p,x)=>e.jsx(Ke,{asChild:!0,children:e.jsx(m,{variant:"outline",className:"w-full",onClick:()=>u(p),children:p})},`${x}-role`))})]})}),e.jsxs(_,{className:"flex gap-2",children:[e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:"Cancel"}),e.jsx(m,{type:"button",onClick:()=>{h(),s(!1)},disabled:l,children:"Change Role"})]})]})})}function ea(){const r=L(),{mutate:s,isPending:a}=N({mutationFn:({userid:n,managerEmail:t,orgid:o})=>De(n,t,o),onSuccess:n=>{r.invalidateQueries({predicate:t=>t.queryKey[0]?.toString()==="emps"}),j.success("Manager Changed successfully",{className:"toast"})},onError:n=>j.error(n.message,{className:"toast"})});return{changeEmpManager:s,isPending:a}}function aa({open:r,setOpen:s,empData:a,orgid:n,changeManager:t,isPending:o}){const[l,d]=i.useState(""),u=()=>{t({orgid:n,managerEmail:l,userid:a._id})};return e.jsx(M,{openModal:r,children:e.jsxs(k,{className:"min-w-sm md:min-w-md",children:[e.jsxs(P,{className:"flex justify-between items-center",children:[e.jsxs(I,{children:["Change Role of ",a.name]}),e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:e.jsx(S,{})})]}),e.jsx(w,{className:"grid gap-2",children:e.jsxs(ne,{title:"change emp Manager",htmlFor:"changemanager",className:"grid",children:[e.jsx("span",{children:"Manager's email id"}),e.jsx(z,{placeholder:"Enter manager's email id",type:"email",value:l,name:"managerEmail",required:!0,className:"text-sm md:text-md",onChange:h=>d(h.target.value)})]})}),e.jsxs(_,{className:"flex gap-2",children:[e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:"Cancel"}),e.jsx(m,{type:"button",onClick:()=>{u(),s(!1)},disabled:o,children:"Change Manager"})]})]})})}function ee(r){return r?.map(s=>({role:s?.data?.role,...s?.data?.employees}))||[]}function sa({orgid:r,isAuthorized:s}){const[n,t]=i.useState(1),[o,l]=i.useState(1),[d,u]=i.useState(!1),[h,p]=i.useState(!1),[x,v]=i.useState(!1),[f,g]=i.useState({_id:"",name:"",email:""}),[y,E]=i.useState(),{data:ve,count:D,isPending:F,error:B}=Me(r,o),{deleteEmp:je,isPending:V}=Ye(),{changeEmpRole:ye,isPending:$}=Xe(),{changeEmpManager:Ee,isPending:Q}=ea(),[H,Ce]=i.useState(null),{mutate:Z}=N({mutationFn:Pe,onSettled:C=>{if(C)Ce(ee(C.employees.map(c=>({data:c}))));else return}}),b=i.useRef(null),Y=i.useCallback(async C=>{b.current&&b.current.abort();const c=new AbortController;b.current=c,C.trim().length&&Z({orgid:r,query:C,controller:c})},[r,Z]),O=i.useMemo(()=>we.debounce(Y,500),[Y]);if(i.useEffect(()=>{F||t(D>5?Math.ceil(D/5):1)},[D,F]),i.useEffect(()=>()=>{O.cancel(),b.current?.abort()},[O]),F)return e.jsx(se,{});if(B){j.error(B.message,{className:"toast"});return}const Re=ee(ve);return e.jsxs("div",{className:" w-full",children:[e.jsx(_e,{title:"Employees",columns:s()?[{key:"name",header:"Name",render:(C,c)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(J,{className:"w-10 h-10",customSeed:c.avatar}),e.jsxs("span",{className:"hidden sm:flex",children:[c?.name," - ( ",c?.role," ",")"]})]})},{key:"email",header:"Email"},{key:"Manage Employee",header:"Manage Employee",render:(C,c)=>e.jsx("div",{className:"flex gap-2 justify-end items-center",children:c.role!=="Owner"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{disabled:$,onClick:()=>{g({_id:c._id,name:c.name,email:c.email}),E(c.role),p(!0)},variant:"outline",children:"Change Role"}),e.jsx(m,{disabled:Q,onClick:()=>{g({_id:c._id,name:c.name,email:c.email}),v(!0)},variant:"outline",title:`Remove ${c.name} from organization`,children:"Change Manager"}),e.jsx(m,{disabled:V,onClick:()=>{g({_id:c._id,name:c.name,email:c.email}),u(!0)},variant:"destructive",title:`Remove ${c.name} from organization`,children:e.jsx(Oe,{})})]})})}]:[{key:"name",header:"Name",render:(C,c)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(J,{className:"w-10 h-10",customSeed:c.avatar}),e.jsxs("span",{className:"hidden sm:flex",children:[c?.name," - ( ",c?.role," ",")"]})]})},{key:"email",header:"Email"}],clientSide:!0,data:H||Re,currentPage:o,totalPages:n,setPage:l,onSearch:O}),e.jsx(We,{open:d,setOpen:u,orgid:r,empData:f,deleteEmp:je,isPending:V}),e.jsx(Je,{open:h,setOpen:p,changeRole:ye,empData:f,isPending:$,oldRole:y||"Staff",orgid:r}),e.jsx(aa,{changeManager:Ee,empData:f,isPending:Q,open:x,orgid:r,setOpen:v})]})}function na(){const{mutate:r,isPending:s}=N({mutationFn:({empEmail:a,role:n})=>Fe(a,n),onSuccess:a=>{j.success(a?.message,{className:"toast"})},onError:a=>j.error(a.message,{className:"toast"})});return{sendInvitation:r,isPending:s}}var U="Radio",[ra,oe]=te(U),[ta,oa]=ra(U),ie=i.forwardRef((r,s)=>{const{__scopeRadio:a,name:n,checked:t=!1,required:o,disabled:l,value:d="on",onCheck:u,form:h,...p}=r,[x,v]=i.useState(null),f=K(s,E=>v(E)),g=i.useRef(!1),y=x?h||!!x.closest("form"):!0;return e.jsxs(ta,{scope:a,checked:t,disabled:l,children:[e.jsx(A.button,{type:"button",role:"radio","aria-checked":t,"data-state":ue(t),"data-disabled":l?"":void 0,disabled:l,value:d,...p,ref:f,onClick:T(r.onClick,E=>{t||u?.(),y&&(g.current=E.isPropagationStopped(),g.current||E.stopPropagation())})}),y&&e.jsx(de,{control:x,bubbles:!g.current,name:n,value:d,checked:t,required:o,disabled:l,form:h,style:{transform:"translateX(-100%)"}})]})});ie.displayName=U;var le="RadioIndicator",ce=i.forwardRef((r,s)=>{const{__scopeRadio:a,forceMount:n,...t}=r,o=oa(le,a);return e.jsx($e,{present:n||o.checked,children:e.jsx(A.span,{"data-state":ue(o.checked),"data-disabled":o.disabled?"":void 0,...t,ref:s})})});ce.displayName=le;var ia="RadioBubbleInput",de=i.forwardRef(({__scopeRadio:r,control:s,checked:a,bubbles:n=!0,...t},o)=>{const l=i.useRef(null),d=K(l,o),u=Ze(a),h=Qe(s);return i.useEffect(()=>{const p=l.current;if(!p)return;const x=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(x,"checked").set;if(u!==a&&f){const g=new Event("click",{bubbles:n});f.call(p,a),p.dispatchEvent(g)}},[u,a,n]),e.jsx(A.input,{type:"radio","aria-hidden":!0,defaultChecked:a,...t,tabIndex:-1,ref:d,style:{...t.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});de.displayName=ia;function ue(r){return r?"checked":"unchecked"}var la=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],G="RadioGroup",[ca,Da]=te(G,[re,oe]),me=re(),pe=oe(),[da,ua]=ca(G),fe=i.forwardRef((r,s)=>{const{__scopeRadioGroup:a,name:n,defaultValue:t,value:o,required:l=!1,disabled:d=!1,orientation:u,dir:h,loop:p=!0,onValueChange:x,...v}=r,f=me(a),g=ze(h),[y,E]=Ue({prop:o,defaultProp:t??null,onChange:x,caller:G});return e.jsx(da,{scope:a,name:n,required:l,disabled:d,value:y,onValueChange:E,children:e.jsx(Be,{asChild:!0,...f,orientation:u,dir:g,loop:p,children:e.jsx(A.div,{role:"radiogroup","aria-required":l,"aria-orientation":u,"data-disabled":d?"":void 0,dir:g,...v,ref:s})})})});fe.displayName=G;var he="RadioGroupItem",ge=i.forwardRef((r,s)=>{const{__scopeRadioGroup:a,disabled:n,...t}=r,o=ua(he,a),l=o.disabled||n,d=me(a),u=pe(a),h=i.useRef(null),p=K(s,h),x=o.value===t.value,v=i.useRef(!1);return i.useEffect(()=>{const f=y=>{la.includes(y.key)&&(v.current=!0)},g=()=>v.current=!1;return document.addEventListener("keydown",f),document.addEventListener("keyup",g),()=>{document.removeEventListener("keydown",f),document.removeEventListener("keyup",g)}},[]),e.jsx(Ve,{asChild:!0,...d,focusable:!l,active:x,children:e.jsx(ie,{disabled:l,required:o.required,checked:x,...u,...t,name:o.name,ref:p,onCheck:()=>o.onValueChange(t.value),onKeyDown:T(f=>{f.key==="Enter"&&f.preventDefault()}),onFocus:T(t.onFocus,()=>{v.current&&h.current?.click()})})})});ge.displayName=he;var ma="RadioGroupIndicator",xe=i.forwardRef((r,s)=>{const{__scopeRadioGroup:a,...n}=r,t=pe(a);return e.jsx(ce,{...t,...n,ref:s})});xe.displayName=ma;var pa=fe,fa=ge,ha=xe;function ga({className:r,...s}){return e.jsx(pa,{"data-slot":"radio-group",className:ae("grid gap-3",r),...s})}function q({className:r,...s}){return e.jsx(fa,{"data-slot":"radio-group-item",className:ae("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",r),...s,children:e.jsx(ha,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(He,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}function xa({open:r,setOpen:s}){const[a,n]=i.useState({empEmail:"",role:"Staff"}),{sendInvitation:t,isPending:o}=na();function l(){a.empEmail.trim()!==""&&["Admin","Manager","Staff"].includes(a.role.trim())?(t(a),s(!1),n({empEmail:"",role:"Staff"})):j.error("Enter the text first",{className:"toast"})}return e.jsx(M,{openModal:r,children:e.jsxs(k,{className:"min-w-md",children:[e.jsxs(P,{className:"flex justify-between items-center",children:[e.jsx(I,{children:"Send Invite"}),e.jsx(m,{onClick:()=>s(!1),variant:"secondary",children:e.jsx(S,{})})]}),e.jsxs(w,{className:"grid gap-3",children:[e.jsxs(R,{title:"New Employee's Email",className:"grid",children:[e.jsx("span",{children:"Employee's email"}),e.jsx(z,{placeholder:"Enter new employee's email",type:"email",value:a.empEmail,name:"empEmail",required:!0,className:"text-sm md:text-md",onChange:d=>n({...a,empEmail:d.target.value.trim()})})]}),e.jsxs(R,{title:"New Employee's role",className:"grid",children:[e.jsx("span",{children:"Enter new employee's role"}),e.jsxs(ga,{defaultValue:a.role,className:"flex",onValueChange:d=>n({...a,role:d}),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{value:"Staff",id:"r1",className:"text-ls-sec-500"}),e.jsx(R,{children:"Staff"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{value:"Manager",id:"r2",className:"text-ls-sec-500"}),e.jsx(R,{children:"Manager"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{value:"Admin",id:"r3",className:"text-ls-sec-500"}),e.jsx(R,{children:"Admin"})]})]})]})]}),e.jsx(_,{className:"flex gap-2",children:e.jsx(m,{type:"button",onClick:l,className:"w-full",disabled:o||a.empEmail.trim()==""||!["Admin","Manager","Staff"].includes(a.role.trim()),children:"Send Invite"})})]})})}function Fa(){const[r,s]=i.useState(!1),{data:a}=W({queryKey:["user"],queryFn:()=>Se()}),{orgSlug:n}=Ne(),{data:t,isPending:o}=W({queryKey:[`org-${n}`],queryFn:()=>Ie(n)}),l=()=>a?.user.myOrg?!!(a?.user||a?.user._id===a?.user.myOrg?.admin):!1;return e.jsxs("div",{className:"gap-2 grid",children:[e.jsx("div",{className:"flex flex-col gap-2 items-baseline h-full w-auto jet-brains rounded-2xl bg-ls-bg-300 dark:bg-ls-bg-dark-800",children:e.jsxs("div",{className:"bg-white dark:bg-ls-bg-dark-800 outline-1 w-full p-3 rounded-2xl flex justify-between items-center",children:[e.jsx(X,{children:"User & Role"}),e.jsx("div",{className:be(l()?"grid":"hidden"),children:e.jsx(m,{onClick:()=>s(!0),disabled:!l(),children:"Invite Employee"})})]})}),o?e.jsx(se,{}):t?e.jsx(sa,{orgid:t?._id,isAuthorized:l}):e.jsxs("div",{className:"h-96 w-full flex flex-col justify-center items-center gap-3 outline-1",children:[e.jsx(X,{children:"Your Organization doesn't have any employees"}),e.jsx(m,{onClick:()=>s(!0),children:"Invite Employees"})]}),e.jsx(xa,{open:r,setOpen:s})]})}export{Fa as default};
