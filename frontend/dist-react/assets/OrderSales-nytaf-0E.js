const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DeleteOrderModal-D38LFsCk.js","assets/index-D0_Sot9h.js","assets/index-bkEeQSt0.css","assets/Close-5X7b8tAm.js","assets/Modal-DMArze6l.js","assets/button-BTAYK3jx.js","assets/Typography-BkeLtctd.js","assets/card-uaHBxQ7j.js","assets/input-CUKpUeOa.js","assets/label-D-KNEtrA.js","assets/separator-Cmc26UhN.js","assets/UpdateOrderModal-dXkrEPGg.js"])))=>i.map(i=>d[i]);
import{c as h,b as O,y as m,a as R,r as a,j as e,_ as q}from"./index-D0_Sot9h.js";import{l as V,C as E,a as $}from"./CustomTableSkeleton-CJzREqlH.js";import{g as k,d as Z,u as H,s as J}from"./apiOrder-_6Dinb-b.js";import{g as C}from"./apiOrg-BN6cYbtf.js";import{u as y,B as F}from"./button-BTAYK3jx.js";import{B as W}from"./badge-CtOZmh4p.js";import{S as X,a as Y,L as P}from"./Typography-BkeLtctd.js";import{D as ee}from"./Profilepage-DVcwLGOJ.js";import{S as i}from"./skeleton-BV3MVaVg.js";import{u as re}from"./useGetOrderReport-D3z5Ph02.js";import{R as x}from"./ReportBar-CvDTllcX.js";import"./card-uaHBxQ7j.js";import"./input-CUKpUeOa.js";import"./separator-Cmc26UhN.js";import"./table-DXp72nU_.js";import"./Pagination-YlnTxVma.js";import"./utilfn-DLliPqnw.js";const se=5;function te(n,t){const d=h(),{data:r,isPending:o}=O({queryKey:["orders",t],queryFn:()=>k(n,t)});return r&&se*t+1<r.count&&d.prefetchQuery({queryKey:["orders",t+1],queryFn:()=>k(n,t+1)}),{ordersResponse:r,isGettingOrders:o}}function ae(){const n=h(),{mutate:t,isPending:d}=y({mutationFn:Z,onSuccess:()=>{n.invalidateQueries({predicate:r=>["orders","orders-report"].includes(r.queryKey[0]?.toString()||"")}),n.invalidateQueries(),m.success("Order deleted successfully",{className:"toast"})},onError:r=>{m.error(r.message,{className:"toast"})}});return{deleteOrderFn:t,isDeletingOrder:d}}function ne(){const n=h(),{mutate:t,isPending:d}=y({mutationFn:({orderId:r,orderUpdated:o})=>H(r,o),onSuccess:()=>{n.invalidateQueries({predicate:r=>["orders","orders-report"].includes(r.queryKey[0]?.toString()||"")}),m.success("Order updated successfully",{className:"toast"})},onError:r=>{m.error(r?.message??"Failed to update order",{className:"toast"})}});return{updateOrderFn:t,isUpdatingOrder:d}}const de=a.lazy(()=>q(()=>import("./DeleteOrderModal-D38LFsCk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),oe=a.lazy(()=>q(()=>import("./UpdateOrderModal-dXkrEPGg.js"),__vite__mapDeps([11,1,2,3,4,5,6,7,8,9,10])));function le(){const{orgSlug:n}=R(),t=5,[d,r]=a.useState(1),[o,M]=a.useState(1),[G,j]=a.useState(!1),[Q,N]=a.useState(!1),[U,A]=a.useState({orderName:"",_id:""}),[T,B]=a.useState({_id:"",item:{_id:"",quantity:1},orderName:"",quantity:1,shipped:!1,orderedOn:new Date,organizationId:""}),{data:g,isPending:z}=O({queryKey:[`org-${n}`],queryFn:()=>C(n)}),{ordersResponse:u,isGettingOrders:p}=te(g?._id,d),{deleteOrderFn:I,isDeletingOrder:S}=ae(),{isUpdatingOrder:b,updateOrderFn:K}=ne(),[v,_]=a.useState(null),{mutate:w}=y({mutationFn:J,onSettled:s=>{if(s)_(s.orders);else return}}),c=a.useRef(null),D=a.useCallback(async s=>{c.current&&c.current.abort();const l=new AbortController;if(c.current=l,s.trim().length)return w({orgid:g._id,query:s,controller:l})},[g?._id,w]),f=a.useMemo(()=>V.debounce(D,500),[D]),L=a.useCallback(s=>{if(s.trim()===""){f.cancel(),_(null),c.current&&c.current.abort();return}f(s)},[f]);return a.useEffect(()=>{!p&&u&&M(u.count>t?Math.ceil(u.count/t):1)},[u,p,o]),p||z?e.jsx(E,{}):e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Orders",columns:[{key:"orderName",header:"Order Name",render:s=>e.jsx(X,{children:s instanceof Date?new Date(s).toLocaleDateString():JSON.stringify(s)})},{key:"quantity",header:"Quantity"},{key:"orderedOn",header:"Ordered On",render:s=>s?new Date(s).toLocaleDateString():"N/A"},{key:"shipped",header:"Shipment Status",render:s=>e.jsx(W,{variant:s?"teritiary":"secondary",children:s?"Shipped":"Under Process"})},{key:"manage",header:"Manage",render:(s,l)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(F,{disabled:b,onClick:()=>{console.log("row data before update",l),B(l),N(!0)},variant:"outline",size:"sm",className:"text-xs sm:text-sm",children:"Update"}),e.jsx(F,{disabled:S,onClick:()=>{A({_id:l._id,orderName:l.orderName}),j(!0)},variant:"destructive",title:`Remove ${l.orderName} from orders`,size:"sm",children:e.jsx(ee,{})})]})}],clientSide:!0,data:v||u?.orders||[],currentPage:d,totalPages:o,setPage:r,onSearch:L}),e.jsx(de,{open:G,setOpen:j,orderData:U,deleteOrderFn:I,isDeletingOrder:S}),e.jsx(oe,{open:Q,setOpen:N,orderData:T,isUpdatingOrder:b,updateOrderFn:K})]})}function we(){const{orgSlug:n}=R(),{data:t,isPending:d}=O({queryKey:[`org-${n}`],queryFn:()=>C(n)}),{report:r,isGettingOrdersReport:o}=re(t?._id);return d||o?e.jsxs("div",{className:"flex flex-col gap-2  items-baseline h-full w-autorounded-2xl bg-ls-bg-300 dark:bg-ls-bg-dark-800",children:[e.jsxs("div",{className:"bg-white dark:bg-ls-bg-dark-800 outline-1 w-full p-3 rounded-2xl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center w-full",children:[e.jsx(i,{className:"w-1/3 h-10"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{className:"h-18 w-18"}),e.jsx(i,{className:"h-18 w-18"})]})]}),e.jsx(i,{className:"w-1/2 h-5"})]}),e.jsx("div",{className:"outline-1 p-4  w-full rounded-2xl",children:e.jsx(i,{className:"w-full h-15"})}),e.jsx(E,{})]}):e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx("div",{className:"grid w-full md:flex md:items-center md:justify-between gap-2 p-1 md:p-3 rounded-lg md:rounded-2xl bg-white dark:bg-ls-bg-dark-800 outline-1",children:e.jsx(Y,{children:"Orders / Sales Management"})}),e.jsxs("main",{className:"w-full grid gap-2 rounded-lg md:rounded-2xl h-full",children:[e.jsxs("div",{className:"outline-1 p-3 rounded-lg md:rounded-2xl flex flex-col gap-2 w-full bg-white dark:bg-ls-bg-dark-800",children:[e.jsx(P,{children:"Orders Summary"}),r?e.jsxs("div",{className:"grid gap-2 grid-cols-1 lg:grid-cols-3 md:grid-cols-2",children:[e.jsx(x,{name:"No. of Orders",value:r.totalOrders,variant:"outline"}),e.jsx(x,{name:"Total Quantity",value:r.totalQuantity,variant:"outline"}),e.jsx(x,{name:"Total Value",value:r.totalRevenue,currency:!0,variant:"secondary",className:"lg:col-span-1 md:col-span-2"})]}):o?e.jsx("div",{className:"w-full",children:e.jsx(i,{className:"w-full h-30"})}):e.jsx(P,{className:"w-full",children:"No Report Found"})]}),e.jsx(le,{})]})]})}export{we as default};
