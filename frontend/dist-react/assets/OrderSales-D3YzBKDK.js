const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DeleteOrderModal-CNwHMnkw.js","assets/index-wf-tjCCz.js","assets/index-4ul3zOFW.css","assets/Close-CF-osNUi.js","assets/Modal-iqcfqeyR.js","assets/button-EG1lfJG5.js","assets/card-D-GtwW-r.js","assets/input-DktSRuev.js","assets/label-ByPLIqZS.js","assets/separator-CrRW6nuX.js","assets/UpdateOrderModal-NQSwO5DJ.js"])))=>i.map(i=>d[i]);
import{a as h,b as g,y as m,c as P,r as n,j as e,_ as q}from"./index-wf-tjCCz.js";import{l as V,C as E,a as $}from"./CustomTableSkeleton-C7ucd0SD.js";import{g as k,d as Z,u as H,s as J,a as W,R as O}from"./ReportBar-B9Ms9fXK.js";import{g as C}from"./apiOrg-UDa7ZxcE.js";import{u as y,S as X,B as F,a as Y,L as R}from"./button-EG1lfJG5.js";import{B as ee}from"./badge-CICYpLaW.js";import{D as re}from"./Profilepage-C6eZmcBL.js";import{S as i}from"./skeleton-B4h73-BI.js";import"./card-D-GtwW-r.js";import"./input-DktSRuev.js";import"./separator-CrRW6nuX.js";import"./Pagination-Dr5pjMs8.js";import"./utilfn-VpFqLrdN.js";const se=5;function te(t,a){const d=h(),{data:r,isPending:o}=g({queryKey:["orders",a],queryFn:()=>k(t,a)});return r&&se*a+1<r.count&&d.prefetchQuery({queryKey:["orders",a+1],queryFn:()=>k(t,a+1)}),{ordersResponse:r,isGettingOrders:o}}function ae(){const t=h(),{mutate:a,isPending:d}=y({mutationFn:Z,onSuccess:()=>{t.invalidateQueries({predicate:r=>["orders","orders-report"].includes(r.queryKey[0]?.toString()||"")}),t.invalidateQueries(),m.success("Order deleted successfully",{className:"toast"})},onError:r=>{m.error(r.message,{className:"toast"})}});return{deleteOrderFn:a,isDeletingOrder:d}}function ne(){const t=h(),{mutate:a,isPending:d}=y({mutationFn:({orderId:r,orderUpdated:o})=>H(r,o),onSuccess:()=>{t.invalidateQueries({predicate:r=>["orders","orders-report"].includes(r.queryKey[0]?.toString()||"")}),m.success("Order updated successfully",{className:"toast"})},onError:r=>{m.error(r?.message??"Failed to update order",{className:"toast"})}});return{updateOrderFn:a,isUpdatingOrder:d}}const de=n.lazy(()=>q(()=>import("./DeleteOrderModal-CNwHMnkw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),oe=n.lazy(()=>q(()=>import("./UpdateOrderModal-NQSwO5DJ.js"),__vite__mapDeps([10,1,2,3,4,5,6,7,8,9])));function le(){const{orgSlug:t}=P(),a=5,[d,r]=n.useState(1),[o,M]=n.useState(1),[G,j]=n.useState(!1),[Q,N]=n.useState(!1),[U,A]=n.useState({orderName:"",_id:""}),[T,B]=n.useState({_id:"",item:{_id:"",quantity:1},orderName:"",quantity:1,shipped:!1,orderedOn:new Date,organizationId:""}),{data:p,isPending:K}=g({queryKey:[`org-${t}`],queryFn:()=>C(t)}),{ordersResponse:u,isGettingOrders:f}=te(p?._id,d),{deleteOrderFn:z,isDeletingOrder:S}=ae(),{isUpdatingOrder:b,updateOrderFn:L}=ne(),[v,_]=n.useState(null),{mutate:w}=y({mutationFn:J,onSettled:s=>{if(s)_(s.orders);else return}}),c=n.useRef(null),D=n.useCallback(async s=>{c.current&&c.current.abort();const l=new AbortController;if(c.current=l,s.trim().length)return w({orgid:p._id,query:s,controller:l})},[p?._id,w]),x=n.useMemo(()=>V.debounce(D,500),[D]),I=n.useCallback(s=>{if(s.trim()===""){x.cancel(),_(null),c.current&&c.current.abort();return}x(s)},[x]);return n.useEffect(()=>{!f&&u&&M(u.count>a?Math.ceil(u.count/a):1)},[u,f,o]),f||K?e.jsx(E,{}):e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Orders",columns:[{key:"orderName",header:"Order Name",render:s=>e.jsx(X,{children:s instanceof Date?new Date(s).toLocaleDateString():JSON.stringify(s)})},{key:"quantity",header:"Quantity"},{key:"orderedOn",header:"Ordered On",render:s=>s?new Date(s).toLocaleDateString():"N/A"},{key:"shipped",header:"Shipment Status",render:s=>e.jsx(ee,{variant:s?"teritiary":"secondary",children:s?"Shipped":"Under Process"})},{key:"manage",header:"Manage",render:(s,l)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(F,{disabled:b,onClick:()=>{console.log("row data before update",l),B(l),N(!0)},variant:"outline",size:"sm",className:"text-xs sm:text-sm",children:"Update"}),e.jsx(F,{disabled:S,onClick:()=>{A({_id:l._id,orderName:l.orderName}),j(!0)},variant:"destructive",title:`Remove ${l.orderName} from orders`,size:"sm",children:e.jsx(re,{})})]})}],clientSide:!0,data:v||u?.orders||[],currentPage:d,totalPages:o,setPage:r,onSearch:I}),e.jsx(de,{open:G,setOpen:j,orderData:U,deleteOrderFn:z,isDeletingOrder:S}),e.jsx(oe,{open:Q,setOpen:N,orderData:T,isUpdatingOrder:b,updateOrderFn:L})]})}function ie(t){const{data:a,isPending:d,isError:r,error:o}=g({queryKey:["orders-report",t],queryFn:()=>W(t),enabled:!!t});return{report:a,isGettingOrdersReport:d,isError:r,error:o}}function be(){const{orgSlug:t}=P(),{data:a,isPending:d}=g({queryKey:[`org-${t}`],queryFn:()=>C(t)}),{report:r,isGettingOrdersReport:o}=ie(a?._id);return d||o?e.jsxs("div",{className:"flex flex-col gap-2  items-baseline h-full w-autorounded-2xl bg-ls-bg-300 dark:bg-ls-bg-dark-800",children:[e.jsxs("div",{className:"bg-white dark:bg-ls-bg-dark-800 outline-1 w-full p-3 rounded-2xl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center w-full",children:[e.jsx(i,{className:"w-1/3 h-10"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{className:"h-18 w-18"}),e.jsx(i,{className:"h-18 w-18"})]})]}),e.jsx(i,{className:"w-1/2 h-5"})]}),e.jsx("div",{className:"outline-1 p-4  w-full rounded-2xl",children:e.jsx(i,{className:"w-full h-30"})}),e.jsx(E,{})]}):e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx("div",{className:"grid w-full md:flex md:items-center md:justify-between gap-2 p-1 md:p-3 rounded-lg md:rounded-2xl bg-white dark:bg-ls-bg-dark-800 outline-1",children:e.jsx(Y,{children:"Orders / Sales Management"})}),e.jsxs("main",{className:"w-full grid gap-2 rounded-lg md:rounded-2xl h-full",children:[e.jsxs("div",{className:"outline-1 p-3 rounded-lg md:rounded-2xl flex flex-col gap-2 w-full bg-white dark:bg-ls-bg-dark-800",children:[e.jsx(R,{children:"Orders Summary"}),r?e.jsxs("div",{className:"grid gap-2 grid-cols-1 lg:grid-cols-3 md:grid-cols-2",children:[e.jsx(O,{name:"No. of Orders",value:r.totalOrders,variant:"outline"}),e.jsx(O,{name:"Total Quantity",value:r.totalQuantity,variant:"outline"}),e.jsx(O,{name:"Total Value",value:r.totalRevenue,currency:!0,variant:"secondary",className:"lg:col-span-1 md:col-span-2"})]}):o?e.jsx("div",{className:"w-full",children:e.jsx(i,{className:"w-full h-30"})}):e.jsx(R,{className:"w-full",children:"No Report Found"})]}),e.jsx(le,{})]})]})}export{be as default};
