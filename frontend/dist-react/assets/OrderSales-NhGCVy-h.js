import{a as q,b as j,y as f,r as i,j as e,c as T}from"./index-D2pWsFwA.js";import{l as re,C as G,a as se}from"./CustomTableSkeleton-CIbr3OOE.js";import{g as P,d as te,u as ae,s as ne,a as de,R as v}from"./ReportBar-DT5cQAgs.js";import{g as Q}from"./apiOrg-BafY1MYC.js";import{u as w,B as c,S as I,b as le,L as _}from"./button-CHgQs-HN.js";import{B as ie}from"./badge-DfQMayD6.js";import{D as oe}from"./Profilepage-Br66LqFQ.js";import{C as A}from"./Close-DHzJ_a41.js";import{M as B}from"./Modal-C0gzKlS3.js";import{C as K,a as D,b as L,c as z,d as $}from"./card-Dn0_vEQo.js";import{I as S}from"./input-D6dxfwAL.js";import{L as y}from"./label-BT6TXPrt.js";import{S as x}from"./skeleton-EBtLC5do.js";import"./separator-Qx3zLuA7.js";import"./Pagination-T_FZ3-lF.js";import"./utilfn-VpFqLrdN.js";const ce=5;function ue(a,t){const r=q(),{data:s,isPending:l}=j({queryKey:["orders",t],queryFn:()=>P(a,t)});return s&&ce*t+1<s.count&&r.prefetchQuery({queryKey:["orders",t+1],queryFn:()=>P(a,t+1)}),{ordersResponse:s,isGettingOrders:l}}function me(){const a=q(),{mutate:t,isPending:r}=w({mutationFn:te,onSuccess:()=>{a.invalidateQueries({predicate:s=>["orders","orders-report"].includes(s.queryKey[0]?.toString()||"")}),a.invalidateQueries(),f.success("Order deleted successfully",{className:"toast"})},onError:s=>{f.error(s.message,{className:"toast"})}});return{deleteOrderFn:t,isDeletingOrder:r}}function pe({open:a,setOpen:t,orderData:r,deleteOrderFn:s,isDeletingOrder:l}){const[n,o]=i.useState("");return e.jsx(B,{openModal:a,children:e.jsxs(K,{className:"w-md max-w-11/12",children:[e.jsxs(D,{className:"flex justify-between items-center",children:[e.jsx(L,{children:"Remove Order"}),e.jsx(c,{onClick:()=>t(!1),variant:"secondary",children:e.jsx(A,{})})]}),e.jsxs(z,{className:"grid gap-4",children:[e.jsxs(I,{children:["Order's Name : ",r.orderName]}),e.jsxs(y,{title:"remove order",htmlFor:"removeorder",className:"grid",children:[e.jsxs("span",{children:['Enter "',e.jsxs("span",{className:"text-red-500",children:["remove ",r.orderName]}),'" in the input below to remove order']}),e.jsx(S,{placeholder:"Enter Text",type:"text",value:n,name:"name",required:!0,className:"text-sm md:text-md",onChange:p=>o(p.target.value)})]})]}),e.jsxs($,{className:"flex gap-2",children:[e.jsx(c,{onClick:()=>t(!1),variant:"secondary",children:"Cancel"}),e.jsx(c,{type:"button",onClick:()=>{s(r._id),t(!1),o("")},disabled:l||n.trim()!==`remove ${r.orderName}`,variant:"destructive",children:"Remove Order"})]})]})})}function xe(){const a=q(),{mutate:t,isPending:r}=w({mutationFn:({orderId:s,orderUpdated:l})=>ae(s,l),onSuccess:()=>{a.invalidateQueries({predicate:s=>["orders","orders-report"].includes(s.queryKey[0]?.toString()||"")}),f.success("Order updated successfully",{className:"toast"})},onError:s=>{f.error(s?.message??"Failed to update order",{className:"toast"})}});return{updateOrderFn:t,isUpdatingOrder:r}}function he({open:a,setOpen:t,orderData:r,updateOrderFn:s,isUpdatingOrder:l}){const[n,o]=i.useState({quantity:r.quantity,shipped:r.shipped,orderedOn:r.orderedOn}),p=()=>{if(console.log("onsubmit order data : ",r),console.log("onsubmit update data: ",n),n.quantity<0||n.quantity>r.item.quantity)return f.error("Order quantity can't be out of item's amount range",{className:"toast"});s({orderId:r._id,orderUpdated:{orderedOn:n.orderedOn,quantity:n.quantity,shipped:n.shipped}})};return i.useEffect(()=>{a&&o({quantity:r.quantity,shipped:r.shipped,orderedOn:r.orderedOn})},[a,r.quantity,r.shipped,r.orderedOn]),e.jsx(B,{openModal:a,children:e.jsxs(K,{className:"w-md max-w-11/12",children:[e.jsxs(D,{className:"flex justify-between items-center",children:[e.jsxs(L,{children:["Update order"," ",r.orderName?r.orderName:"Order"]}),e.jsx(c,{onClick:()=>t(!1),variant:"secondary",children:e.jsx(A,{})})]}),e.jsxs(z,{className:"grid gap-2 max-h-80 overflow-auto sm:px-1",children:[e.jsxs(y,{htmlFor:"quantity",className:"grid",children:[e.jsx("span",{children:"Quantity"}),e.jsx(S,{id:"quantity",name:"quantity",type:"number",onFocus:m=>m.target.select(),value:n.quantity,className:"text-sm md:text-md",min:1,max:r.item.quantity,onChange:m=>o({...n,quantity:Number(m.target.value)}),placeholder:"Update item quantity",required:!0})]}),e.jsxs(y,{htmlFor:"Ordered On",className:"grid",children:[e.jsx("span",{children:"Ordered On"}),e.jsx(S,{id:"orderedon",name:"orderedOn",type:"date",value:new Date(n.orderedOn).toISOString().split("T")[0],max:new Date().toISOString().split("T")[0],onChange:m=>{o({...n,orderedOn:new Date(m.target.valueAsDate||n.orderedOn)})},placeholder:"Enter item's order date",className:"w-full text-sm md:text-md",required:!0})]}),e.jsxs(y,{htmlFor:"isshipped",className:"grid",children:[e.jsx("span",{children:"Is Shipped"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2",children:[e.jsx(c,{variant:n.shipped?"outline":"secondary",onClick:()=>o({...n,shipped:!1}),className:"sm:rounded-r-none",children:"Under Process"}),e.jsx(c,{variant:n.shipped?"secondary":"outline",onClick:()=>o({...n,shipped:!0}),className:"sm:rounded-l-none",children:"Shipped"})]})]})]}),e.jsxs($,{className:"flex gap-2",children:[e.jsx(c,{onClick:()=>t(!1),variant:"secondary",children:"Cancel"}),e.jsx(c,{type:"button",onClick:()=>{p(),t(!1)},disabled:l,children:"Update Order"})]})]})})}function ge(){const{orgSlug:a}=T(),t=5,[r,s]=i.useState(1),[l,n]=i.useState(1),[o,p]=i.useState(!1),[m,C]=i.useState(!1),[H,Z]=i.useState({orderName:"",_id:""}),[J,V]=i.useState({_id:"",item:{_id:"",quantity:1},orderName:"",quantity:1,shipped:!1,orderedOn:new Date,organizationId:""}),{data:O,isPending:W}=j({queryKey:[`org-${a}`],queryFn:()=>Q(a)}),{ordersResponse:h,isGettingOrders:N}=ue(O?._id,r),{deleteOrderFn:X,isDeletingOrder:k}=me(),{isUpdatingOrder:F,updateOrderFn:Y}=xe(),[R,U]=i.useState(null),{mutate:E}=w({mutationFn:ne,onSettled:d=>{if(d)U(d.orders);else return}}),g=i.useRef(null),M=i.useCallback(async d=>{g.current&&g.current.abort();const u=new AbortController;if(g.current=u,d.trim().length)return E({orgid:O._id,query:d,controller:u})},[O?._id,E]),b=i.useMemo(()=>re.debounce(M,500),[M]),ee=i.useCallback(d=>{if(d.trim()===""){b.cancel(),U(null),g.current&&g.current.abort();return}b(d)},[b]);return i.useEffect(()=>{!N&&h&&n(h.count>t?Math.ceil(h.count/t):1)},[h,N,l]),N||W?e.jsx(G,{}):e.jsxs(e.Fragment,{children:[e.jsx(se,{title:"Orders",columns:[{key:"orderName",header:"Order Name",render:d=>e.jsx(I,{children:d instanceof Date?new Date(d).toLocaleDateString():JSON.stringify(d)})},{key:"quantity",header:"Quantity"},{key:"orderedOn",header:"Ordered On",render:d=>d?new Date(d).toLocaleDateString():"N/A"},{key:"shipped",header:"Shipment Status",render:d=>e.jsx(ie,{variant:d?"teritiary":"secondary",children:d?"Shipped":"Under Process"})},{key:"manage",header:"Manage",render:(d,u)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(c,{disabled:F,onClick:()=>{console.log("row data before update",u),V(u),C(!0)},variant:"outline",size:"sm",className:"text-xs sm:text-sm",children:"Update"}),e.jsx(c,{disabled:k,onClick:()=>{Z({_id:u._id,orderName:u.orderName}),p(!0)},variant:"destructive",title:`Remove ${u.orderName} from orders`,size:"sm",children:e.jsx(oe,{})})]})}],clientSide:!0,data:R||h?.orders||[],currentPage:r,totalPages:l,setPage:s,onSearch:ee}),e.jsx(pe,{open:o,setOpen:p,orderData:H,deleteOrderFn:X,isDeletingOrder:k}),e.jsx(he,{open:m,setOpen:C,orderData:J,isUpdatingOrder:F,updateOrderFn:Y})]})}function fe(a){const{data:t,isPending:r,isError:s,error:l}=j({queryKey:["orders-report",a],queryFn:()=>de(a),enabled:!!a});return{report:t,isGettingOrdersReport:r,isError:s,error:l}}function Pe(){const{orgSlug:a}=T(),{data:t,isPending:r}=j({queryKey:[`org-${a}`],queryFn:()=>Q(a)}),{report:s,isGettingOrdersReport:l}=fe(t?._id);return r||l?e.jsxs("div",{className:"flex flex-col gap-2  items-baseline h-full w-autorounded-2xl bg-ls-bg-300 dark:bg-ls-bg-dark-800",children:[e.jsxs("div",{className:"bg-white dark:bg-ls-bg-dark-800 outline-1 w-full p-3 rounded-2xl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center w-full",children:[e.jsx(x,{className:"w-1/3 h-10"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{className:"h-18 w-18"}),e.jsx(x,{className:"h-18 w-18"})]})]}),e.jsx(x,{className:"w-1/2 h-5"})]}),e.jsx("div",{className:"outline-1 p-4  w-full rounded-2xl",children:e.jsx(x,{className:"w-full h-30"})}),e.jsx(G,{})]}):e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx("div",{className:"grid w-full md:flex md:items-center md:justify-between gap-2 p-1 md:p-3 rounded-lg md:rounded-2xl bg-white dark:bg-ls-bg-dark-800 outline-1",children:e.jsx(le,{children:"Orders / Sales Management"})}),e.jsxs("main",{className:"w-full grid gap-2 rounded-lg md:rounded-2xl h-full",children:[e.jsxs("div",{className:"outline-1 p-3 rounded-lg md:rounded-2xl flex flex-col gap-2 w-full bg-white dark:bg-ls-bg-dark-800",children:[e.jsx(_,{children:"Orders Summary"}),s?e.jsxs("div",{className:"grid gap-2 grid-cols-1 lg:grid-cols-3 md:grid-cols-2",children:[e.jsx(v,{name:"No. of Orders",value:s.totalOrders,variant:"outline"}),e.jsx(v,{name:"Total Quantity",value:s.totalQuantity,variant:"outline"}),e.jsx(v,{name:"Total Value",value:s.totalRevenue,currency:!0,variant:"secondary",className:"lg:col-span-1 md:col-span-2"})]}):l?e.jsx("div",{className:"w-full",children:e.jsx(x,{className:"w-full h-30"})}):e.jsx(_,{className:"w-full",children:"No Report Found"})]}),e.jsx(ge,{})]})]})}export{Pe as default};
